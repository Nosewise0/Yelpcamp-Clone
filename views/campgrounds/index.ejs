<% layout('layout/boilerplate') %>

  <div id="map" style="width: 100%; height: 500px;" class="mb-5"></div>

  <div class="container py-5">
    <!-- Header Section -->
    <div class="row mb-5">
      <div class="col-lg-8">
        <h1 class="display-4 fw-bold text-primary mb-3">
          <i class="bi bi-tent-fill"></i> Explore Campgrounds
        </h1>
        <p class="lead text-muted">Discover amazing camping spots from our community</p>
      </div>
      <div class="col-lg-4 d-flex align-items-center justify-content-lg-end">
        <a href="/campgrounds/new" class="btn btn-success btn-lg rounded-pill px-4">
          <i class="bi bi-plus-circle-fill"></i> Add New Campground
        </a>
      </div>
    </div>

    <!-- Campgrounds Grid -->
    <% if (campgrounds.length===0) { %>
      <div class="alert alert-info rounded-4 text-center py-5" role="alert">
        <i class="bi bi-info-circle-fill display-6"></i>
        <h4 class="mt-3">No campgrounds yet!</h4>
        <p class="mb-3">Be the first to create one.</p>
        <a href="/campgrounds/new" class="btn btn-primary rounded-pill">
          <i class="bi bi-plus-circle-fill"></i> Create Campground
        </a>
      </div>
      <% } else { %>
        <div class="row g-4">
          <% for (let campground of campgrounds) { %>
            <div class="col-xl-4 col-lg-6 col-md-12">
              <div class="card border-0 shadow-lg rounded-4 h-100 overflow-hidden transition-all"
                style="cursor: pointer; transition: transform 0.3s ease, box-shadow 0.3s ease;">

                <!-- Image Section -->
                <div class="position-relative overflow-hidden" style="height: 250px;">
                  <% if (campground.image && campground.image.length> 0) { %>
                    <img src="<%= campground.image[0].url %>" alt="<%= campground.title %>"
                      class="card-img-top h-100 w-100" style="object-fit: cover; transition: transform 0.3s ease;">
                    <% } else { %>
                      <img src="https://via.placeholder.com/400x300?text=No+Image" alt="No Image"
                        class="card-img-top h-100 w-100" style="object-fit: cover;">
                      <% } %>

                        <!-- Price Badge -->
                        <div class="position-absolute top-0 end-0 m-3">
                          <span class="badge bg-success rounded-pill px-3 py-2 fs-6">
                            <i class="bi bi-cash-coin"></i> $<%= campground.price %>/night
                          </span>
                        </div>

                        <!-- Image Count Badge -->
                        <% if (campground.image && campground.image.length> 1) { %>
                          <div class="position-absolute bottom-0 end-0 m-3">
                            <span class="badge bg-dark rounded-pill px-3 py-2">
                              <i class="bi bi-images"></i>
                              <%= campground.image.length %> photos
                            </span>
                          </div>
                          <% } %>
                </div>

                <!-- Card Content -->
                <div class="card-body p-4 d-flex flex-column">
                  <h5 class="card-title fw-bold mb-2 text-primary">
                    <%= campground.title %>
                  </h5>

                  <p class="card-text text-muted mb-3"
                    style="display: -webkit-box; -webkit-box-orient: vertical; overflow: hidden; -webkit-line-clamp: 2; line-clamp: 2;">
                    <%= campground.description %>
                  </p>

                  <!-- Location -->
                  <p class="mb-4">
                    <i class="bi bi-geo-alt-fill text-danger"></i>
                    <small class="text-muted">
                      <%= campground.location %>
                    </small>
                  </p>

                  <!-- View Button -->
                  <a class="btn btn-primary rounded-pill w-100 fw-bold mt-auto"
                    href="/campgrounds/<%= campground._id %>">
                    <i class="bi bi-eye-fill"></i> View Details
                  </a>
                </div>
              </div>
            </div>
            <% } %>
        </div>
        <% } %>
  </div>

  <!-- Add hover effect styling -->
  <style>
    .transition-all:hover {
      transform: translateY(-8px);
      box-shadow: 0 1rem 3rem rgba(0, 0, 0, 0.175) !important;
    }

    .card-img-top:hover {
      transform: scale(1.05);
    }

    .fancy-clamp {
      /* WebKit fallback (works today in Chromium / Safari) */
      display: -webkit-box;
      -webkit-box-orient: vertical;
      overflow: hidden;
      -webkit-line-clamp: 3;

      /* Standard property (future-proof / progressive enhancement) */
      line-clamp: 3;
    }
  </style>

  <%- "<script>" %>
    const maptilerApiKey = "<%- process.env.MAPTILER_API_KEY %>";
      const campgrounds = {
      type: "FeatureCollection",
      features: <%- JSON.stringify( campgrounds.map(campground=> ({
        type: "Feature",
        geometry: campground.geometry,
        properties: { popUpMarkup: campground?.properties?.popUpMarkup }
        }))
        ) %>
        };
        <%- "</script>" %>

          <script src="/javascripts/clusterMap.js"></script>